\begin{frame}{Dataset Overview}
 \begin{center}
    \begin{figure}
    \centering
     \begin{tikzpicture}
        % Sample image and dimensions
         \node[visible on=<1->, step_rectangle] at (0,5.9) (sample) {\includegraphics[scale=0.4]{sample_defect.png}};
        \draw[decoration={mirror,raise=3mm},decorate] (-2.6,8.2) -- (-2.6,3.6) node[left,midway] {480};
        \draw[decoration={mirror,raise=-3mm},decorate] (-2.3,3.33) -- (2.3,3.33) node[below,midway] {480};

        % Metadata boxes
        \node[visible on=<2->, right=\imgfinal of sample, step_rectangle, xshift = 1.5cm, yshift = 1.5cm] (firstrectcenter) {Technology};
        \node[visible on=<2->, left=\img of firstrectcenter, step_rectangle] (firstrectleft) {...};
        \node[visible on=<2->, right=\img of firstrectcenter, step_rectangle] (firstrectright) {...};
        
        \node[visible on=<3->, right=\imgfinal of sample, step_rectangle, xshift = 1.65cm, yshift = 0cm] (secondrectcenter) {Product};
        \node[visible on=<3->, left=\img of secondrectcenter, step_rectangle] (secondrectleft) {...};
        \node[visible on=<3->, right=\img of secondrectcenter, step_rectangle] (secondrectright) {...};
        
        \node[visible on=<4->, right=\imgfinal of sample, step_rectangle, xshift = 1.5cm, yshift = -1.5cm] (thirdrectcenter) {Step/Layer};
        \node[visible on=<4->, left=\img of thirdrectcenter, step_rectangle] (thirdrectleft) {...};
        \node[visible on=<4->, right=\img of thirdrectcenter, step_rectangle] (thirdrectright) {...};

        %  Arrows
        \draw[visible on=<3->, arrow_small] (firstrectcenter) -- (secondrectcenter);
        \draw[visible on=<3->, arrow_small] (firstrectcenter) -- (secondrectleft);
        \draw[visible on=<3->, arrow_small] (firstrectcenter) -- (secondrectright);
        
        \draw[visible on=<4->, arrow_small] (secondrectcenter) -- (thirdrectcenter);
        \draw[visible on=<4->, arrow_small] (secondrectcenter) -- (thirdrectleft);
        \draw[visible on=<4->, arrow_small] (secondrectcenter) -- (thirdrectright);
        
     \end{tikzpicture}
     \caption*{\hspace*{4em} Image dimensions. \uncover<2->{\hspace*{7em} Correlated metadata.}}

     \end{figure}
 \end{center}
\end{frame}

\begin{frame}{Dataset Distribution}
  \begin{figure}[h]
    \centering
        \resizebox{8cm}{4.5cm}{
        \begin{tikzpicture}[font=\small]
            \pgfplotsset{every axis/.append style={
                axis x line=middle,    % put the x axis in the middle
                axis y line=middle,    % put the y axis in the middle
                axis line style={-}, % arrows on the axis
                label style={font=\small},
                tick label style={font=\tiny},
                },}
            \begin{axis} [ybar,
              bar width=3.1mm,
              ymin=0,
              ymax=1500,
              xtick=data,
              axis x line=bottom,
              axis y line=left,
              enlarge x limits=0.02,
              x=0.31cm,
              ylabel={Samples}, 
              xlabel={Label},
              x label style={at={(axis description cs:0.5,-0.1)},anchor=north},
              y label style={at={(axis description cs:-0.05,.5)},rotate=90,anchor=south},                    
              ]
              \only<2->{\draw[dashed, maincolor] (axis cs:0, 500) -- (axis cs:37.5, 500);}
              \only<1>{\addplot[scatter,scatter src=y,mark=ybar, fill = plotcolor, draw=maincolor] coordinates {
                (1,441)
                (2,136)
                (3,168)
                (4,415)
                (5,1492)
                (6,1410)
                (7,58)
                (8,309)
                (9,85)
                (10,95)
                (11,174)
                (12,375)
                (13,156)
                (14,408)
                (15,190)
                (16,286)
                (17,337)
                (18,477)
                (19,101)
                (20,372)
                (21,659)
                (22,630)
                (23,256)
                (24,50)
                (25,168)
                (26,52)
                (27,988)
                (28,209)
                (29,830)
                (30,212)
                (31,168)
                (32,92)
                (33,83)
                (34,51)
                (35,417)
                (36,131)
                (37,128)
              };}
              \only<2>{\addplot[scatter,scatter src=y,mark=ybar, fill = plotcolor, draw=maincolor] coordinates {
                (1,441)
                (2,136)
                (3,168)
                (4,415)
                (5,1492)
                (6,1410)
                (7,58)
                (8,309)
                (9,85)
                (10,95)
                (11,174)
                (12,375)
                (13,156)
                (14,408)
                (15,190)
                (16,286)
                (17,337)
                (18,477)
                (19,101)
                (20,372)
                (21,659)
                (22,630)
                (23,256)
                (24,50)
                (25,168)
                (26,52)
                (27,988)
                (28,209)
                (29,830)
                (30,212)
                (31,168)
                (32,92)
                (33,83)
                (34,51)
                (35,417)
                (36,131)
                (37,128)
              };}
              \only<3>{\addplot[scatter,scatter src=y,mark=ybar, fill = plotcolor, draw=maincolor] coordinates {
                (1,441)
                (2,136)
                (3,168)
                (4,415)
                (5,500)
                (6,500)
                (7,58)
                (8,309)
                (9,85)
                (10,95)
                (11,174)
                (12,375)
                (13,156)
                (14,408)
                (15,190)
                (16,286)
                (17,337)
                (18,477)
                (19,101)
                (20,372)
                (21,500)
                (22,500)
                (23,256)
                (24,50)
                (25,168)
                (26,52)
                (27,500)
                (28,209)
                (29,500)
                (30,212)
                (31,168)
                (32,92)
                (33,83)
                (34,51)
                (35,417)
                (36,131)
                (37,128)
              };}
              \only<4>{\addplot[scatter,scatter src=y,mark=ybar, fill = plotcolor, draw=maincolor] coordinates {
                (1,500)
                (2,500)
                (3,500)
                (4,500)
                (5,500)
                (6,500)
                (7,500)
                (8,500)
                (9,500)
                (10,500)
                (11,500)
                (12,500)
                (13,500)
                (14,500)
                (15,500)
                (16,500)
                (17,500)
                (18,500)
                (19,500)
                (20,500)
                (21,500)
                (22,500)
                (23,500)
                (24,500)
                (25,500)
                (26,500)
                (27,500)
                (28,500)
                (29,500)
                (30,500)
                (31,500)
                (32,500)
                (33,500)
                (34,500)
                (35,500)
                (36,500)
                (37,500)
              };}
              
              \end{axis}
        \end{tikzpicture}
        }\hspace*{1em}
    \only<1>{\caption*{Initial defect class distribution.}}
    \only<2>{\caption*{Initial defect class distribution.}}
    \only<3>{\caption*{Downsampled defect class distribution.}}
    \only<4>{\caption*{Resampled (upsampled \& downsampled) defect class distribution.}}
    \end{figure}
\end{frame}
    
\begin{frame}{Data Augmentation}
    \begin{table}[h]
        \noindent
        \makebox[\linewidth]{
          \centering
          \begin{tabular}{SSS}
          \toprule
          {\textbf{Name}} & {\textbf{Description}} & {\textbf{Value}}   \\ \midrule
          {Horizontal flip}  & {Mirror the image on the x-axis}              & {\{True, False\}} \\ 
          {Vertical flip}    & {Mirror the image on the y-axis}              & {\{True, False\}} \\
          {Rotation}         & {Rotate the image with respect to its center} & {$[-90, 90]$}\\ 
          {Zoom}             & {Zoom in} & {$[1, 1.3]$} \\ 
          {Horizontal shift} & {Shift the image horizontally}                & {$[-0.5, 0.5]$} \\
          {Vertical shift}   & {Shift the image vertically}                  & {$[-0.5, 0.5]$} \\
          \bottomrule
          \end{tabular}
          }
          \caption*{Transformations applied to images.}
    \end{table}
\end{frame}

\begin{frame}{Backbone Architecture: ResNet50}
    \begin{figure}
        \centering
        \begin{tikzpicture}
            \node[fill=orange!50] (l1) {layer 1};
            \node[blue!50!black, right=of l1, label={below:activation}] (act1) {$a(\mathbf{x})$};
            \node[fill=teal!50, right=of act1] (l2) {layer 2};
            \node[right=of l2, font=\Large, label={below:add}, inner sep=0, pin={60:$\mathcal F(\mathbf{x}) + \vec x$}] (add) {$\oplus$};
            \node[blue!50!black, right=of add, label={below:activation}] (act2) {$a(\mathbf{x})$};
          
            \draw[->] (l1) -- (act1);
            \draw[->] (act1) -- (l2);
            \draw[<-] (l1) -- ++(-2,0) node[below, pos=0.8] {$\mathbf{x}$};
            \draw[->] (l2) -- (act2) node[above, pos=0.8] {};
            \draw[->] ($(l1)-(1.5,0)$) to[out=90, in=90] node[below=1ex, midway, align=center] {skip connection\\(identity)} node[above, midway] {$\mathbf{x}$} (add);
            \draw[decorate, decoration={brace, amplitude=1ex, raise=1cm}] (l2.east) -- node[midway, below=1.2cm] {$\mathcal F(\mathbf{x})$} (l1.west);
          
        \end{tikzpicture}
        \caption*{Residual block.}
    \end{figure}
\end{frame}

\begin{frame}{Backbone Architecture: EfficientNet}
    \begin{figure}
        \centering
            \includegraphics[scale=0.2]{effnet_pic.png}
            \caption*{EfficientNet-B$0$.}
    \end{figure}
\end{frame}

\begin{frame}{Dataset Subdivision}
    \begin{normalblock}{Unknown generation}
        \begin{itemize}
          \item No unknown class can be present in the dataset.
          \item For methodology testing purposes, dataset is divided in $\mathcal{K}$ and $\mathcal{U}$.
        \end{itemize}
    \end{normalblock}

    \begin{table}
        \noindent
        \makebox[\linewidth]{
            \centering
            \begin{tabular}{SSS}
            \toprule
            {\textbf{Name}} & {\textbf{Symbol}} & {\textbf{Composition}} \\ \midrule
            {Training set} & {$\mathcal{D}_{train}$} & {70\% of $\mathcal{K}$'s samples}\\
            {Validation set} & {$\mathcal{D}_{val}$} & {20\% of $\mathcal{K}$'s samples}\\
            {In-test set} & {$\mathcal{D}^{\mathcal{K}}_{test}$} & {10\% of $\mathcal{K}$'s samples}\\
            {Out-test set} & {$\mathcal{D}^{\mathcal{U}}_{test}$} & {100\% of $\mathcal{U}$'s samples}\\
            \bottomrule
            \end{tabular}
        }
        \caption*{Subsets of the original dataset.}
    \end{table}
\end{frame}

\begin{frame}{Distance Method with Ground Truth}
    \begin{minipage}{0.5\textwidth}
        \centering
        \begin{overprint}
            \onslide<1-5>\begin{normalblock}{Method steps}
                \begin{itemize}
                    \item <1-> Backbone trained on $\mathcal{D}_{train}$.
                    \item <2-> Latent representations $\mathcal{S}_{train} = {\{\mathbf{s}_i\}}_{i=1}^{n_1}$ of $\mathcal{D}_{train}$ extracted.
                    \item <3-> Clusters $\mathcal{C} = {\{c_j\}}_{j=1}^{|\mathcal{K}|}$ formed using ground truth labels.
                    \item <4-> Centroids $\mathbf{\mu}_j$ found for each cluster.
                    \item <5-> Distances $d_{i,j}$ from centroids evaluated.
                \end{itemize}
            \end{normalblock}
            \onslide<6->\begin{normalblock}{Method steps}
              \begin{itemize}
                  \item <6->For each cluster, the distance $\bar{d_j}$, corresponding to a chosen $P$-th percentile, is found.
                  \item <7-> $\mathbf{x} \in \mathcal{D}_{test}$ fed to the backbone. 
                  \item <8-> Distances $\hat{d_j}$ from centroids evaluated.
                  \item <9-> $\mathbf{x}$ classified as unknown if: 
                  \[
                      \hat{d_j} > \bar{d_j} \quad \forall j=1, \dots, |\mathcal{K}|\,.
                  \]
              \end{itemize}
          \end{normalblock}
        \end{overprint}
    \end{minipage}
    \hspace{0.2cm}
    \begin{minipage}{0.46\textwidth}
        \centering
        \scalebox{.73}{
        \onslide<2->\begin{tikzpicture}
                  
            \pgfplotsset{
                scale only axis,
            }
            
            \begin{axis}[
              xmin=0.4, 
              xmax=1, 
              ymin=0.5, 
              ymax=1.1,
              x=10cm,
              y=10cm,
              ticks=none]
              \addplot[visible on=<2>, only marks, mark=asterisk, color=black]
              coordinates{
                (0.47,0.58)
                (0.52,0.57)
                (0.5,0.65)
                (0.45,0.62)
                (0.49,0.6)
              };
              \addplot[visible on=<2>, only marks, mark=asterisk, color=black]
              coordinates{
                (0.65,0.87)
                (0.66,0.89)
                (0.75,0.95)
                (0.72,0.98)
                (0.64,0.82)
              }; 
              \addplot[visible on=<2>, only marks, mark=asterisk, color=black]
              coordinates{
                (0.81,0.59)
                (0.88,0.57)
                (0.79,0.61)
                (0.85,0.63)
                (0.92,0.59)
              }; 

              \addplot[visible on=<3->, only marks, mark=asterisk, color=customgreen]
              coordinates{
                (0.47,0.58)
                (0.52,0.57)
                (0.5,0.65)
                (0.45,0.62)
                (0.49,0.6)
              };
              \addplot[visible on=<3->, only marks, mark=asterisk, color=customblue]
              coordinates{
                (0.65,0.87)
                (0.66,0.89)
                (0.75,0.95)
                (0.72,0.98)
                (0.64,0.82)
              }; 
              \addplot[visible on=<3->, only marks, mark=asterisk, color=customred]
              coordinates{
                (0.81,0.59)
                (0.88,0.57)
                (0.79,0.61)
                (0.85,0.63)
                (0.92,0.59)
              }; 

              % centroids
              \addplot[visible on=<4->, only marks, mark=*, color=customgreen]
              coordinates{
                (0.486,0.604)
              }; 

              \addplot[visible on=<4->, only marks, mark=*, color=customblue]
              coordinates{
                (0.686,0.901)
              }; 

              \addplot[visible on=<4->, only marks, mark=*, color=customred]
              coordinates{
                (0.85,0.6)
              }; 
              
              % text
              \node[] at (axis cs: 0.45,1.05) {$\mathcal{X}$};
              \node[visible on=<2>] at (axis cs: 0.6,1) {$S_{train}$};
              \node[visible on=<3->, color=customblue] at (axis cs: 0.6,1) {$c_1$};
              \node[visible on=<3->, color=customgreen] at (axis cs: 0.5,0.7) {$c_2$};
              \node[visible on=<3->, color=customred] at (axis cs: 0.9,0.72) {$c_3$};
          
              % lines to centroids
              \addplot[visible on=<5->, color=customgreen] coordinates{(0.47,0.58) (0.486,0.604)};
              \addplot[visible on=<5->, color=customgreen] coordinates{(0.5,0.65) (0.486,0.604)};
              \addplot[visible on=<5->, color=customgreen] coordinates{(0.45,0.62) (0.486,0.604)};
              \addplot[visible on=<5->, color=customgreen] coordinates{(0.49,0.6) (0.486,0.604)};
              \addplot[visible on=<5>, color=customgreen] coordinates{(0.52,0.57) (0.486,0.604)};
              \addplot[visible on=<6->, color=black] coordinates{(0.52,0.57) (0.486,0.604)};

              \addplot[visible on=<5->, color=customblue] coordinates{(0.65,0.87) (0.686,0.901)};
              \addplot[visible on=<5->, color=customblue] coordinates{(0.66,0.89) (0.686,0.901)};
              \addplot[visible on=<5->, color=customblue] coordinates{(0.75,0.95) (0.686,0.901)};
              \addplot[visible on=<5->, color=customblue] coordinates{(0.72,0.98) (0.686,0.901)};
              \addplot[visible on=<5>, color=customblue] coordinates{(0.64,0.82) (0.686,0.901)};
              \addplot[visible on=<6->, color=black] coordinates{(0.64,0.82) (0.686,0.901)};

              \addplot[visible on=<5->, color=customred] coordinates{(0.81,0.59) (0.85,0.6)};
              \addplot[visible on=<5->, color=customred] coordinates{(0.88,0.57) (0.85,0.6)};
              \addplot[visible on=<5->, color=customred] coordinates{(0.79,0.61) (0.85,0.6)};
              \addplot[visible on=<5->, color=customred] coordinates{(0.85,0.63) (0.85,0.6)};
              \addplot[visible on=<5>, color=customred] coordinates{(0.92,0.59) (0.85,0.6)};
              \addplot[visible on=<6->, color=black] coordinates{(0.92,0.59) (0.85,0.6)};

              % outlier
              \addplot[visible on=<7-9>, only marks, mark=asterisk, color=black]
              coordinates{(0.7,0.7)}; 
              \addplot[visible on=<8-9>, color=black] coordinates{(0.7,0.7) (0.486,0.604)};
              \addplot[visible on=<8-9>, color=black] coordinates{(0.7,0.7) (0.686,0.901)};
              \addplot[visible on=<8-9>, color=black] coordinates{(0.7,0.7) (0.85,0.6)};
              \node[visible on=<9>] at (axis cs: 0.79,0.73) {\emph{unknown}};

              % outlier2
              \addplot[visible on=<10-12>, only marks, mark=asterisk, color=black]
              coordinates{(0.7,0.85)}; 
              \addplot[visible on=<11-12>, color=black] coordinates{(0.7,0.85) (0.486,0.604)};
              \addplot[visible on=<11-12>, color=black] coordinates{(0.7,0.85) (0.686,0.901)};
              \addplot[visible on=<11-12>, color=black] coordinates{(0.7,0.85) (0.85,0.6)};
              \node[visible on=<12>] at (axis cs: 0.78,0.87) {\emph{known}};

            \end{axis}
        \end{tikzpicture}
        }
    \end{minipage}
\end{frame}

\begin{frame}{Distance Method without Ground Truth}
    \centering
    \begin{normalblock}{Method steps}
        \begin{itemize}
            \item \textcolor{black!20}{Backbone trained on $\mathcal{D}_{train}$.}
            \item \textcolor{black!20}{Latent representations $\mathcal{S}_{train} = {\{\mathbf{s}_i\}}_{i=1}^{n_1}$ of $\mathcal{D}_{train}$ extracted.}
            \item Clusters $\mathcal{C} = {\{c_j\}}_{j=1}^{|\mathcal{K}|}$ formed using \emph{clustering algorithms}.
            \item \textcolor{black!20}{Centroids $\mathbf{\mu}_j$ found for each cluster.}
            \item \textcolor{black!20}{Distances $d_{i,j}$ from centroids evaluated.}
        \end{itemize}
  \end{normalblock}
\end{frame}

\begin{frame}{Mahalanobis Distance}
  \begin{minipage}{0.47\textwidth}
      \centering
      \begin{definitionblock}{Definition}
          \begin{itemize}
              \item Let $\mathbf{\mu} = {(\mu_1, \dots, \mu_N)}^T$ be the centroid of a distribution $Q$ and $\Sigma$ its positive-definite covariance matrix. The Mahalanobis distance of a point $\mathbf{x}$ from Q is defined as:
              \[
                  d_M(\mathbf{x}, Q) = \sqrt{{(\mathbf{x}-\mathbf{\mu})}^T\Sigma^{-1}(\mathbf{x}-\mathbf{\mu})}\,.
              \]
          \end{itemize}
      \end{definitionblock}
  \end{minipage}
  \quad
  \begin{minipage}{0.49\textwidth}
          \begin{figure}[h]
              \centering
              \scalebox{.63}{
                  \begin{tikzpicture}
                  
                      \pgfplotsset{
                          scale only axis,
                      }
                      
                      \begin{axis}[
                        xmin=-10, 
                        xmax=10, 
                        ymin=-10, 
                        ymax=10,
                        %axis equal image
                        x=0.4cm,
                        y=0.4cm,
                        %ticks=none,
                        legend style={font=\small},
                        legend pos = south east
                        ]
                
                        \addlegendimage{color=red}
                        \addlegendentry{$d_m = 1$}
                
                        \addlegendimage{color=red, dash pattern=on 3pt off 3pt}
                        \addlegendentry{$d_m = 2$}
                
                        \addlegendimage{color=red, dash pattern=on \pgflinewidth off 2pt, line width=0.3mm}
                        \addlegendentry{$d_m = 3$}
                
                        \addlegendimage{color=blue}
                        \addlegendentry{$d_e = 5$}
                
                        %\addlegendentry{plot 2}
                
                        %\draw[rotate around={-35:(0.7,0.9)},blue, fill=blue, fill opacity=0.2] (0.7,0.9) ellipse (9pt and 15pt);
                        \begin{scope}[on background layer]
                        \addplot[ultra thin, only marks, mark=*, color=black, mark size = 0.35pt]
                        coordinates{
                          (3.35, 2.45)
                          (-2.27, -0.77)
                          (-1.73, -1.68)
                          (1.42, 1.71)
                          (2.99, 2.42)
                          (2.08, 1.36)
                          (-1.00, -0.54)
                          (1.01, 0.46)
                          (0.13, 0.36)
                          (4.89, 4.69)
                          (-1.08, -0.03)
                          (4.98, 5.91)
                          (-0.03, 1.68)
                          (-3.43, -4.31)
                          (-0.02, -1.91)
                          (2.54, 0.79)
                          (-1.71, -2.23)
                          (0.70, 0.81)
                          (0.52, 0.18)
                          (3.35, 1.53)
                          (1.12, 0.50)
                          (1.08, 0.66)
                          (3.99, 5.18)
                          (-0.76, 0.28)
                          (1.83, 0.61)
                          (-1.82, -2.24)
                          (-3.81, -3.64)
                          (-0.24, -0.03)
                          (0.35, 1.41)
                          (-0.74, 0.12)
                          (0.17, 2.08)
                          (-2.48, -2.90)
                          (1.39, -0.35)
                          (2.64, 4.18)
                          (4.24, 3.74)
                          (0.92, -2.18)
                          (0.55, 0.53)
                          (-3.36, -3.79)
                          (-2.68, -3.09)
                          (-1.93, -0.52)
                          (0.46, 4.28)
                          (-4.71, -3.39)
                          (-2.29, -3.05)
                          (0.77, 0.94)
                          (-4.03, -4.79)
                          (2.35, 2.48)
                          (-0.20, -2.22)
                          (2.88, 3.39)
                          (4.15, 3.82)
                          (0.95, 2.98)
                          (0.20, -0.52)
                          (-0.48, -2.26)
                          (-2.71, -3.59)
                          (-1.34, -1.35)
                          (3.44, 2.29)
                          (4.14, 4.63)
                          (0.73, 0.92)
                          (0.49, 0.79)
                          (3.12, 5.08)
                          (-0.97, 0.03)
                          (3.01, 2.51)
                          (-1.49, -0.37)
                          (-1.07, -1.75)
                          (0.50, -0.21)
                          (-1.84, 0.36)
                          (-1.58, -2.64)
                          (1.94, 2.63)
                          (5.60, 4.57)
                          (-2.23, -1.76)
                          (1.68, 3.44)
                          (4.98, 4.90)
                          (5.35, 6.05)
                          (2.70, 3.22)
                          (-4.40, -5.58)
                          (-1.18, -2.77)
                          (3.63, 3.19)
                          (1.96, 2.93)
                          (1.96, 2.48)
                          (-6.20, -4.98)
                          (2.79, 2.31)
                          (1.75, 2.70)
                          (2.05, 4.48)
                          (-1.69, -0.23)
                          (-1.77, -1.11)
                          (3.96, 3.57)
                          (-1.03, -2.10)
                          (1.32, 0.80)
                          (3.12, 3.67)
                          (-3.30, -1.27)
                          (2.26, 3.21)
                          (2.44, 0.02)
                          (1.00, 0.36)
                          (1.14, -0.65)
                          (1.66, 2.27)
                          (2.07, 1.23)
                          (-4.57, -2.98)
                          (-1.13, -0.52)
                          (-0.66, -2.92)
                          (1.19, 2.75)
                          (0.54, -1.81)
                          (-0.86, -1.34)
                          (2.95, 0.68)
                          (6.48, 5.59)
                          (1.20, 1.28)
                          (-6.02, -5.50)
                          (4.28, 4.69)
                          (1.96, 0.18)
                          (4.60, 6.05)
                          (-3.87, -5.58)
                          (-1.28, -0.45)
                          (-2.82, -3.11)
                          (-0.54, 3.27)
                          (3.42, 5.25)
                          (-1.31, -2.01)
                          (0.82, -0.41)
                          (0.21, 0.68)
                          (1.75, 0.77)
                          (0.01, -0.89)
                          (2.17, 2.23)
                          (0.99, 1.76)
                          (7.42, 7.52)
                          (-3.81, -3.36)
                          (-0.97, -1.38)
                          (-0.19, 0.68)
                          (2.82, 3.34)
                          (-1.09, -0.00)
                          (4.20, 3.11)
                          (0.62, 0.60)
                          (-2.25, -2.29)
                          (-2.77, -2.54)
                          (1.97, 2.64)
                          (-0.71, 0.07)
                          (1.77, 2.92)
                          (2.43, 1.29)
                          (2.67, 3.69)
                          (2.44, 2.79)
                          (2.97, 3.07)
                          (-0.80, 0.61)
                          (1.31, 1.34)
                          (-1.05, -0.98)
                          (-0.99, -0.45)
                          (-1.86, -1.16)
                          (0.57, 2.05)
                          (0.84, 0.48)
                          (3.37, 2.19)
                          (-1.92, -1.54)
                          (-1.69, -2.83)
                          (1.01, 1.76)
                          (3.78, 4.89)
                          (0.67, 0.77)
                          (3.88, 4.07)
                          (0.28, 0.77)
                          (-0.75, -0.54)
                          (-1.87, 0.47)
                          (0.91, 1.32)
                          (-5.59, -5.61)
                          (0.88, 2.41)
                          (3.76, 3.20)
                          (-1.90, -1.28)
                          (1.35, 2.79)
                          (-0.08, 1.78)
                          (-0.32, -0.69)
                          (-2.52, -1.01)
                          (-1.48, 0.96)
                          (-2.30, -0.36)
                          (-2.25, -3.63)
                          (-0.21, -1.23)
                          (-0.92, -1.23)
                          (-1.44, -1.20)
                          (-2.53, -2.23)
                          (-1.35, -2.24)
                          (-0.09, 0.65)
                          (2.44, 3.36)
                          (0.00, -1.80)
                          (-0.47, -1.57)
                          (2.88, 1.70)
                          (0.63, -0.33)
                          (0.96, -0.35)
                          (3.51, 3.62)
                          (2.26, 2.65)
                          (7.35, 7.35)
                          (2.54, 0.62)
                          (1.71, 3.60)
                          (3.73, 4.79)
                          (-1.29, -2.68)
                          (-2.51, -1.96)
                          (-1.33, -0.12)
                          (3.14, 0.94)
                          (0.40, -0.14)
                          (2.08, 1.33)
                          (-0.60, -1.06)
                          (-5.62, -5.19)
                          (2.13, 1.08)
                          (-3.22, -1.99)
                          (-2.48, -1.25)
                          (4.18, 3.93)
                          (3.00, 4.66)
                          (-0.55, -1.78)
                          (3.24, 2.61)
                          (-0.59, 0.67)
                          (-3.43, -3.79)
                          (-0.90, -2.08)
                          (4.47, 3.20)
                          (-6.32, -6.43)
                          (-2.47, -2.52)
                          (-4.28, -4.22)
                          (3.93, 3.93)
                          (-2.14, -1.19)
                          (-1.44, -2.74)
                          (4.94, 2.25)
                          (-3.59, -1.08)
                          (-2.16, -1.71)
                          (-1.35, -1.30)
                          (-0.01, -0.51)
                          (7.10, 5.70)
                          (1.04, 2.28)
                          (1.35, 0.54)
                          (-0.15, 0.67)
                          (0.79, 2.29)
                          (-2.58, -1.23)
                          (2.93, 2.24)
                          (-1.00, -0.67)
                          (0.17, 0.34)
                          (3.35, 4.75)
                          (-0.65, -0.89)
                          (2.06, 1.47)
                          (-0.34, -0.07)
                          (-2.16, -2.04)
                          (0.24, -0.39)
                          (-0.01, -1.06)
                          (-1.51, -1.04)
                          (0.77, 0.56)
                          (-5.96, -5.99)
                          (0.85, 0.20)
                          (-4.52, -4.54)
                          (3.98, 3.44)
                          (-2.53, -2.13)
                          (-1.48, -1.52)
                          (2.66, 2.01)
                          (0.74, -0.49)
                          (1.25, 0.90)
                          (-1.76, -2.72)
                          (-2.33, -3.36)
                          (-2.40, -1.95)
                          (-1.32, -0.85)
                          (1.56, -1.26)
                          (2.48, 2.12)
                          (-2.01, -1.29)
                          (-0.90, -1.12)
                          (2.83, 1.78)
                          (-1.54, -0.14)
                          (4.37, 3.94)
                          (0.68, 0.03)
                          (1.52, 2.81)
                          (2.38, 0.79)
                          (-1.32, -0.06)
                          (2.02, 3.37)
                          (2.53, 2.26)
                          (1.40, 2.09)
                          (-0.70, -0.05)
                          (-1.41, -2.57)
                          (-2.57, -3.69)
                          (0.23, -0.26)
                          (0.00, 1.39)
                          (0.92, -0.58)
                          (-1.93, -1.81)
                          (0.70, 0.64)
                          (-1.95, -0.03)
                          (-4.15, -4.00)
                          (-0.24, -1.37)
                          (3.96, 3.61)
                          (3.93, 3.83)
                          (2.68, 3.20)
                          (-3.41, -3.46)
                          (-1.37, -0.10)
                          (-1.75, -3.07)
                          (-1.22, -1.91)
                          (1.49, 3.90)
                          (-3.44, -1.14)
                          (6.02, 3.82)
                          (-0.79, 0.36)
                          (-5.33, -3.34)
                          (-3.40, -4.28)
                          (6.47, 6.96)
                          (-0.95, -4.95)
                          (3.47, 3.26)
                          (-2.53, -3.08)
                          (-3.44, -3.35)
                          (2.73, 1.93)
                          (4.54, 5.01)
                          (-0.92, 0.60)
                          (0.32, 1.51)
                          (0.53, 0.24)
                          (-3.51, -3.34)
                          (-2.32, -2.95)
                          (-1.31, -2.22)
                          (0.46, 0.06)
                          (-0.25, 0.53)
                          (-0.78, -0.43)
                          (-4.16, -2.44)
                          (1.99, 2.41)
                          (-0.87, 0.27)
                          (-0.03, 0.62)
                          (-0.83, -1.90)
                          (4.49, 4.42)
                          (-0.27, -0.72)
                          (-1.30, -2.76)
                          (1.27, 1.48)
                          (1.08, 1.57)
                          (-2.39, -2.06)
                          (-5.10, -5.08)
                          (-2.22, -1.59)
                          (-4.67, -5.36)
                          (-1.98, -1.92)
                          (-0.47, -1.39)
                          (-2.78, -3.04)
                          (1.90, 0.26)
                          (-1.06, -2.08)
                          (1.52, 0.47)
                          (1.62, 3.20)
                          (-3.91, -3.87)
                          (-0.39, -2.58)
                          (-0.79, -0.69)
                          (0.31, -0.15)
                          (-5.59, -5.88)
                          (0.14, -0.16)
                          (-2.01, -2.44)
                          (2.01, 1.17)
                          (-0.40, 0.36)
                          (-3.16, -2.25)
                          (2.47, 0.75)
                          (0.40, -1.82)
                          (-1.87, -1.80)
                          (1.00, 1.34)
                          (0.49, -0.78)
                          (3.22, 0.55)
                          (-6.02, -6.04)
                          (-2.70, -3.42)
                          (-0.46, 0.12)
                          (1.82, 0.41)
                          (0.11, -0.02)
                          (0.66, 0.82)
                          (-0.08, 0.78)
                          (1.25, 2.55)
                          (1.34, 1.68)
                          (1.61, 1.09)
                          (0.40, 1.00)
                          (-2.04, -3.57)
                          (0.73, -0.06)
                          (-1.76, -2.05)
                          (-2.05, -2.73)
                          (-5.18, -2.78)
                          (-0.81, -1.18)
                          (-0.05, 0.74)
                          (3.78, 4.35)
                          (3.05, 3.93)
                          (5.62, 4.56)
                          (5.43, 4.91)
                          (0.24, -0.43)
                          (0.32, 2.15)
                          (-1.05, -0.06)
                          (0.41, -0.81)
                          (0.32, 0.34)
                          (3.01, 2.62)
                          (-0.15, -0.63)
                          (0.31, -0.06)
                          (4.56, 4.67)
                          (3.64, 4.22)
                          (-4.56, -3.85)
                          (3.66, 4.97)
                          (-1.81, 0.66)
                          (2.25, 4.03)
                          (-6.37, -5.75)
                          (2.38, 2.07)
                          (0.79, 1.56)
                          (-3.73, -2.25)
                          (-3.46, -1.52)
                          (3.74, 5.21)
                          (3.43, 2.01)
                          (0.43, 0.02)
                          (5.01, 6.82)
                          (2.44, 1.16)
                          (2.31, 1.53)
                          (3.16, 3.34)
                          (2.26, 3.03)
                          (-1.17, -2.11)
                          (0.67, 0.78)
                          (0.98, -0.29)
                          (-4.52, -3.97)
                          (5.43, 4.14)
                          (0.46, 1.82)
                          (-0.36, -0.50)
                          (2.39, 2.21)
                          (0.21, 0.30)
                          (-3.39, -4.26)
                          (3.85, 3.94)
                          (2.15, 1.88)
                          (-0.54, -0.23)
                          (-4.28, -2.14)
                          (3.96, 3.81)
                          (-1.32, -1.33)
                          (-1.49, -4.78)
                          (-2.83, -3.37)
                          (4.37, 5.83)
                          (-0.06, -0.58)
                          (-2.93, -2.68)
                          (-1.16, -2.52)
                          (3.60, 1.03)
                          (0.05, 2.27)
                          (-1.15, -1.19)
                          (4.55, 3.64)
                          (-1.01, -0.30)
                          (0.47, -0.66)
                          (-0.61, -1.26)
                          (0.49, -0.72)
                          (0.90, 1.13)
                          (-3.65, -2.67)
                          (3.45, 3.99)
                          (-0.45, 1.46)
                          (-3.72, -4.25)
                          (-6.33, -7.70)
                          (-1.77, -3.11)
                          (-3.56, -3.35)
                          (-1.14, -0.45)
                          (-6.99, -5.14)
                          (4.44, 5.59)
                          (0.61, 0.33)
                          (1.11, 2.17)
                          (-0.92, 0.66)
                          (-3.22, -1.29)
                          (0.53, 2.01)
                          (0.02, 0.28)
                          (-2.77, -2.43)
                          (2.76, 4.85)
                          (4.56, 4.10)
                          (-3.65, -3.90)
                          (-2.77, -4.64)
                          (3.34, 1.57)
                          (0.70, 0.74)
                          (0.01, -0.59)
                          (-0.77, -0.13)
                          (4.59, 4.15)
                          (-4.99, -4.51)
                          (1.03, 0.16)
                          (-0.97, -1.13)
                          (-2.17, 0.89)
                          (-3.31, -2.14)
                          (0.63, -0.02)
                          (2.06, 2.56)
                          (2.55, 2.45)
                          (-0.86, -0.03)
                          (0.60, -0.26)
                          (1.64, -0.66)
                          (-0.50, -0.62)
                          (3.47, 3.43)
                          (1.35, 2.13)
                          (-3.43, -5.01)
                          (-0.71, 0.54)
                          (-1.34, -1.66)
                          (-1.43, 0.18)
                          (-1.84, -2.34)
                          (4.41, 2.62)
                          (1.38, 1.20)
                          (-1.28, -1.16)
                          (1.65, 0.66)
                          (-2.00, -0.97)
                          (1.50, 0.35)
                          (2.86, 1.23)
                          (2.68, 2.84)
                          (2.73, 0.41)
                          (4.52, 3.33)
                          (5.95, 8.08)
                          (0.38, -1.40)
                          (-2.13, -0.78)
                          (0.45, -1.83)
                          (1.49, -0.97)
                          (0.62, 0.75)
                          (0.40, 0.75)
                          (-1.95, -3.45)
                          (-1.18, -0.71)
                          (-1.37, -1.36)
                          (6.02, 6.19)
                          (-0.26, -2.40)
                          (4.67, 3.54)
                          (0.23, 0.77)
                          (1.34, 3.13)
                          (3.70, 1.35)
                          (3.07, 0.47)
                          (-4.40, -6.16)
                          (1.24, -0.26)
                          (1.20, 0.71)
                          (1.58, 1.37)
                          (3.88, 4.72)
                          (0.74, 0.44)
                          (-1.43, -0.80)
                          (0.27, -0.67)
                          (3.31, 3.00)
                          (3.38, 3.34)
                          (-0.82, -0.90)
                          (-2.02, -3.28)
                          (3.06, 2.08)
                          (1.64, 1.32)
                          (-4.40, -4.99)
                          (-0.82, -0.68)
                          (2.90, 2.77)
                          (-2.05, -2.51)
                          (-2.43, -1.69)
                          (-3.21, -2.51)
                          (-4.62, -4.02)
                          (4.12, 2.77)
                          (-1.95, -1.55)
                          (-2.50, -1.93)
                          (0.01, 0.21)
                          (-1.46, -1.71)
                          (1.60, -0.04)
                          (-1.69, -3.40)
                          (2.93, 1.62)
                          (-1.61, -0.77)
                          (2.21, 2.09)
                          (2.05, 2.67)
                          (-2.99, -0.05)
                          (2.62, 3.36)
                          (1.26, 0.21)
                          (-0.17, -0.31)
                          (-4.73, -4.87)
                          (-0.95, 0.57)
                          (-0.28, -1.80)
                          (-0.83, 0.14)
                          (-3.11, -2.80)
                          (-0.68, 0.24)
                          (-2.30, -2.22)
                          (-0.08, -0.43)
                          (0.86, -0.98)
                          (-1.92, -1.02)
                          (-3.91, -3.30)
                          (-0.54, -0.14)
                          (-0.73, -1.44)
                          (1.98, 1.29)
                          (-2.63, -2.47)
                          (-1.31, -1.24)
                          (-3.54, -1.56)
                          (-0.65, -2.60)
                          (0.54, 1.23)
                          (-2.22, -0.63)
                          (0.31, 1.49)
                          (-1.27, -0.86)
                          (-0.94, -2.23)
                          (0.51, 2.67)
                          (0.08, 1.22)
                          (2.92, 4.08)
                          (-1.01, -1.06)
                          (-0.23, -1.42)
                          (-1.74, -2.19)
                          (0.11, 0.76)
                          (-1.14, 0.79)
                          (-4.50, -4.25)
                          (2.71, 1.21)
                          (-0.83, 0.13)
                          (-0.40, 1.14)
                          (4.31, 2.92)
                          (1.29, -0.47)
                          (0.29, -0.65)
                          (-0.06, 2.76)
                          (-1.55, -1.60)
                          (-2.77, -1.65)
                          (-1.34, 0.36)
                          (-5.55, -4.23)
                          (-1.89, -0.05)
                          (3.25, 3.70)
                          (-1.16, -0.87)
                          (3.53, 0.57)
                          (2.24, 4.12)
                          (1.96, 2.00)
                          (-0.86, -2.18)
                          (4.57, 4.10)
                          (-0.16, -0.65)
                          (-1.73, -0.58)
                          (3.42, 2.54)
                          (1.55, 2.83)
                          (-5.46, -3.94)
                          (-3.45, -3.08)
                          (4.50, -0.90)
                          (2.06, 2.84)
                          (-1.91, -3.78)
                          (1.88, 3.50)
                          (3.92, 1.78)
                          (2.57, 1.46)
                          (-0.01, -0.33)
                          (0.39, 0.58)
                          (0.16, 0.92)
                          (1.32, 0.68)
                          (-0.11, -0.14)
                          (1.03, -0.37)
                          (0.90, 2.06)
                          (1.96, 0.98)
                          (-1.37, -1.09)
                          (-0.63, -2.26)
                          (-2.77, 0.12)
                          (-1.61, -2.12)
                          (0.29, -0.28)
                          (-3.68, -4.22)
                          (2.50, 1.58)
                          (-3.44, -3.59)
                          (2.00, 0.29)
                          (1.63, 1.50)
                          (-0.44, -0.50)
                          (-2.54, -3.70)
                          (3.54, 4.20)
                          (-1.15, 0.30)
                          (-2.58, -0.27)
                          (-2.97, -2.11)
                          (4.28, 4.65)
                          (2.85, 2.50)
                          (-6.65, -6.74)
                          (-1.09, 0.78)
                          (2.18, 1.32)
                          (-3.77, -3.82)
                          (-0.10, 0.12)
                          (-4.24, -3.08)
                          (4.45, 4.77)
                          (0.09, 1.27)
                          (-0.84, -1.33)
                          (-2.44, -2.87)
                          (0.98, 0.81)
                          (-2.03, -0.40)
                          (-1.98, -2.71)
                          (-1.30, 0.13)
                          (-3.39, -4.91)
                          (-0.88, -0.94)
                          (3.70, 3.57)
                          (0.00, -0.84)
                          (-3.34, -5.27)
                          (-4.74, -4.43)
                          (0.52, 2.58)
                          (1.13, -1.44)
                          (-4.09, -3.50)
                          (1.15, -0.13)
                          (2.84, 1.96)
                          (5.74, 6.08)
                          (-2.67, -2.98)
                          (-4.45, -3.58)
                          (-0.98, 0.10)
                          (6.97, 6.49)
                          (-0.64, -1.92)
                          (-3.53, -4.51)
                          (-1.45, -0.51)
                          (-1.85, -1.06)
                          (-0.75, -0.82)
                          (-0.08, -0.61)
                          (2.27, 1.32)
                          (2.18, 0.47)
                          (2.57, -0.06)
                          (-2.25, 0.04)
                          (-0.08, -0.33)
                          (0.45, 1.57)
                          (3.08, 1.37)
                          (-2.32, -1.79)
                          (0.86, 0.25)
                          (1.95, 1.88)
                          (-4.17, -4.57)
                          (6.17, 5.14)
                          (0.02, -0.78)
                          (0.21, 0.46)
                          (-1.59, -0.36)
                          (-2.20, -2.74)
                          (1.40, 0.96)
                          (-1.38, -1.99)
                          (2.52, 1.97)
                          (-3.70, -1.47)
                          (1.92, 0.29)
                          (0.79, 0.80)
                          (2.46, 2.19)
                          (3.85, 2.90)
                          (-1.59, -1.19)
                          (-1.41, -1.31)
                          (-0.98, -0.03)
                          (1.75, 2.41)
                          (0.28, 0.01)
                          (-3.41, -3.62)
                          (1.01, -0.75)
                          (2.60, 0.25)
                          (-0.52, -1.41)
                          (-0.35, -0.11)
                          (-0.30, 1.13)
                          (1.93, 0.50)
                          (3.64, 4.70)
                          (2.50, 4.28)
                          (4.26, 4.44)
                          (6.97, 6.93)
                          (-1.43, 0.97)
                          (-0.67, 0.17)
                          (-0.27, -1.47)
                          (0.42, -0.74)
                          (-2.11, -0.61)
                          (4.82, 4.78)
                          (-2.06, -2.35)
                          (-0.84, -0.55)
                          (-1.79, -1.54)
                          (-0.98, -0.67)
                          (-1.41, -0.86)
                          (-1.62, -1.97)
                          (1.82, 0.28)
                          (4.26, 1.31)
                          (2.52, 1.02)
                          (-1.41, -1.50)
                          (-1.88, -0.58)
                          (3.14, 3.46)
                          (-2.92, -2.71)
                          (-1.53, -1.76)
                          (5.88, 5.26)
                          (-0.63, -0.12)
                          (2.56, 2.29)
                          (2.46, 2.05)
                          (0.28, 1.62)
                          (2.30, 1.18)
                          (-0.30, -1.74)
                          (6.48, 4.75)
                          (0.98, 0.47)
                          (2.53, 3.01)
                          (-2.03, -1.82)
                          (-1.52, -1.88)
                          (-4.03, -0.74)
                          (-3.13, -2.30)
                          (-2.80, -4.19)
                          (-5.43, -6.11)
                          (-0.70, -4.46)
                          (3.79, 3.41)
                          (4.83, 4.85)
                          (1.26, 1.57)
                          (0.52, 0.93)
                          (2.65, 2.20)
                          (3.13, 3.49)
                          (-0.98, 0.68)
                          (-2.89, -2.58)
                          (2.52, 2.17)
                          (-9.19, -8.07)
                          (1.55, 1.91)
                          (-5.71, -5.49)
                          (-0.73, -0.61)
                          (1.48, 0.70)
                          (-1.37, -2.06)
                          (0.31, 1.99)
                          (3.81, 2.19)
                          (2.82, 1.79)
                          (-4.34, -6.15)
                          (5.10, 5.44)
                          (-4.33, -3.47)
                          (-1.22, 0.86)
                          (1.41, 0.96)
                          (-2.08, -0.73)
                        }; \label{plot_three_0}
                        %\addlegendimage{/pgfplots/refstyle=plot_three_0}
                        \end{scope}
                
                        \addplot[only marks, mark=*, color=black]
                        coordinates{
                        (0, 0)
                        };
                        
                
                        \draw[->, black, line width=0.4mm] (0,0) -- (3.5, 3.25);
                        \draw[->, black, line width=0.4mm] (0,0) -- (-1, 1);
                
                        %\draw[blue] (0,0) circle (4);
                        \draw[blue] (0,0) circle (5);
                        %\draw[blue] (0,0) circle (7);
                    
                        %\draw[rotate around={43:(0,0)},red] (0,0) ellipse (5.47 and 1.73); %1-std dev
                        \draw[rotate around={43:(0,0)},red] (0,0) ellipse (5.47 and 1.3);
                        %\draw[rotate around={43:(0,0)},red, dash pattern=on 3pt off 3pt] (0,0) ellipse (7.74 and 2.44); %2-std dev
                        \draw[rotate around={43:(0,0)},red, dash pattern=on 3pt off 3pt] (0,0) ellipse (7.74 and 2);
                        %\draw[rotate around={43:(0,0)},red, dash pattern=on \pgflinewidth off 2pt, line width=0.3mm] (0,0) ellipse (9.47 and 2.99);
                        %3-std dev
                        \draw[rotate around={43:(0,0)},red, dash pattern=on \pgflinewidth off 2pt, line width=0.3mm] (0,0) ellipse (9.47 and 2.7);
                
                      \end{axis}
                  \end{tikzpicture}
              }
              \caption*{\footnotesize{  Loci with fixed Mahalanobis and Euclidean distances.}} %Euclidean from the centroid, Mahalanobis from the distribution
          \end{figure}
  \end{minipage}
\end{frame}

\begin{frame}{Reciprocal Points Learning Method}
  \begin{figure}
      \centering
      \includegraphics[width=.7\textwidth]{ARPL}
      \caption*{Reciprocal points learning scheme.}
  \end{figure}
\end{frame}

\begin{frame}{Reciprocal Points Learning Method}
    \begin{definitionblock}{Definition}
        \begin{itemize}
          \item Overall loss: 
          \[
              \mathcal{L}(x; \theta, \mathcal{P}, R) = \mathcal{L}_c(x; \theta, \mathcal{P}) + \lambda \mathcal{L}_{\mathcal{O}}(x; \theta, \mathcal{P}, R)\,,
          \]
          with
          \begin{align*}
              \begin{aligned}
                  \mathcal{L}_c(x;\theta, \mathcal{P}) &= -\log p(y=k|x, f_{\theta}, \mathcal{P}) \\
                  \mathcal{L}_{\mathcal{O}}(x; \theta, \mathcal{P}^k, R^k) &= \frac{1}{M}\sum_{i=1}^M \Vert d(f_{\theta}(x), p_i^k)-R^k \Vert^2_2\,.
              \end{aligned}
          \end{align*}
        \end{itemize}
    \end{definitionblock}
\end{frame}

\begin{frame}{Perfomance Metrics}
    \begin{normalblock}{Metrics used}
        \begin{itemize}
          \item<1-> Classification metric:
          \[
              \text{accuracy} = \frac{1}{N}\sum_{i=1}^N \mathds{1} (y_i = \hat{y}_i)\,.
          \]
          \item<2-> Novelty detection: \emph{AUC} with 
          \[
              TPR = \frac{TP}{TP+FN}, \quad FPR = \frac{FP}{FP+TN}\,.
          \]
          \item<3-> Clustering: 
          \[
              ARI = \frac{R-\EX(R)}{1-\EX(R)}\,.
          \]
        \end{itemize}
    \end{normalblock}
\end{frame}
